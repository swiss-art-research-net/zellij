{% extends 'menubase.html' %}

{% block header %}
    <h1>{% block title %}{{ "Update" if existing else "Create" }} AirTable Database{% endblock %}</h1>
{% endblock %}

{% block content %}
    <form method="post">
        <div class="fields">
            <label for="apiname">Name</label>
            <input name="apiname" id="apiname" required value="{{ existing["dbasename"] }}">
            <label for="secret">APIKey</label>
            <input name="apikey" id="apikey" required value="{{ existing["dbaseapikey"] }}">
            <label for="githubrepo">Repository Name</label>
            <input name="githubrepo" id="githubrepo" value="{{ existing["githubrepo"] or "" }}">
            <label for="githubtoken">Access Token</label>
            <input name="githubtoken" id="githubtoken" value="{{ existing["githubtoken"] or "" }}">
            <label for="githuborganization">Github Organization</label>
            <input name="githuborganization" id="githuborganization" value="{{ existing["githuborganization"] or "" }}">
            <label for="fieldbase">Field Base ID</label>
            <input name="fieldbase" id="fieldbase" value="{{ existing["fieldbase"] or "" }}">
            <label for="collectionbase">Collection Base ID</label>
            <input name="collectionbase" id="collectionbase" value="{{ existing["collectionbase"] or "" }}">
            <label for="projectbase">Project Base ID</label>
            <input name="projectbase" id="projectbase" value="{{ existing["projectbase"] or "" }}">

            <button type="submit">{{ "Update" if existing else "Create" }} Database</button>
            {% if existing %}
                <button type="button" id="delete-button">Delete Database</button>
            {% endif %}
        </div>
    </form>

    <script>
        function deleteDB() {
            $.ajax({
                url: "{{ url_for('datasources.airTableDatabaseDelete', accountid=existing['airtableaccountkey'], dbaseid=existing['dbaseid']) }}",
                type: "DELETE",
                success: function () {
                    window.location.href = "{{ url_for('datasources.connections') }}";
                }
            });
        }

        const deleteButton = document.getElementById('delete-button');
        deleteButton.addEventListener('click', deleteDB);
    </script>
{% endblock %}
